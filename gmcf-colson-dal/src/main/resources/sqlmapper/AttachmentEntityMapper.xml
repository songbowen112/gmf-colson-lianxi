<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.colson.dal.dao.AttachmentEntityMapper">
  <resultMap id="BaseResultMap" type="com.colson.dal.model.AttachmentEntity">
    <!--@mbg.generated-->
    <!--@Table payment-->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="fileName" jdbcType="VARCHAR" property="fileName" />
    <result column="prefix" jdbcType="VARCHAR" property="prefix" />
    <result column="fileUrl" jdbcType="VARCHAR" property="fileUrl" />
    <result column="roundId" jdbcType="INTEGER" property="roundId" />
    <result column="roundName" jdbcType="VARCHAR" property="roundName" />
  </resultMap>

  <select id="selectAttachmentList" resultMap="BaseResultMap">
    select
       a.id as id,
       a.file_name as fileName,
        a.prefix as prefix,
       a.file_url as fileUrl,
       er.id                                                              roundId,
       er.name                                                            roundName
from (select IFNULL(c.main_teach_unit_id, t.id)       AS teachUnitId,
             GROUP_CONCAT(DISTINCT t.id)              AS teachUnitIdStr,
             GROUP_CONCAT(DISTINCT t.teach_unit_name) AS teachUnitName
      from t_teach_unit t
               LEFT JOIN t_teach_unit_combine_detail c ON t.id = c.teach_unit_id AND c.delete_flag = 0
      where t.teach_type_code = 'Z'
        and t.status = 1
        and t.round_id in (
                           17219384,17288129,17288130,17288131,17288132,17300910,17302446,17307713,17312941,17318023,17318024,17319343,17319344,17321675,17321676,17321677,17321678,17321679,17321680,17338568,17347306,17347307,17347308,17347311,17347312,17347313,17348264,17348266,17348267,17348268,17348272,17348275,17348278,17369142,17369143,17369144,17369753,17369760,17369767,17370159,17370161,17370162,17370163,17370164,17370165,17370167,17370168,17370169,17370170,17370172,17370173,17370174,17370175,17370177,17370178,17370179,17370180,17370181,17370182,17370183,17370184,17370186,17370187,17370188,17370189,17370191,17370192,17370193,17370194,17370196,17370197,17370198,17370199,17370200,17370201,17370202,17370203,17370204,17370205,17370206,17370207,17370208,17370209,17370210,17370211,17370212,17370213,17370214,17387990,17387996,17387997,17387998,17392115,17392117,17393790,17393791,17393792,17393793,17395039,17395040,17407589,17426313,17426314,17426315,17426316,17426317,17426318,17426319,17426320,17426321,17426323,17426324,17426702,17426703,17426704,17426706,17426707,17426709,17426710,17426934,17428478,17428479,17429789,17434139,17434140,17434142,17434143,17434144,17434145,17434147,17434148,17434149,17434150,17434152,17434153,17439472,17439473,17439475,17439476,17439490,17441512,17441513,17441514,17441515
                           )
      group by teachUnitId) tu
         INNER JOIN t_teach_unit t on tu.teachUnitId = t.id
         INNER JOIN ent_round er on er.id = t.round_id and er.delete_flag = 0
         LEFT JOIN t_teach_unit_resource_rel nltu ON t.id = nltu.new_live_teach_unit_id AND nltu.delete_flag = 0
         LEFT JOIN t_attachment a on a.business_id = tu.teachUnitId;
  </select>

</mapper>